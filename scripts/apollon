#!/usr/bin/env python3

"""Launch the apollon main app """

import sys
import argparse
import subprocess

import apollon
from apollon import commands


_valid_subcommand = ('features', 'onsets', 'hmm', 'som', 'export')


def _parse_cml(argv):
    parser = argparse.ArgumentParser('Apollon main app')
    parser.add_argument('--version', action='version', version=apollon.__version__,
                        help='Disply apollon version.')

    subparsers = parser.add_subparsers()

    subp_features = subparsers.add_parser('features', help='')
    subp_features.add_argument('--rhythm', action='store_true',
                        help='Extract features for rhythm track.')

    subp_features.add_argument('--timbre', action='store_true',
                        help='Extract features for timbre track.')

    subp_features.add_argument('--export', type=str, action='store')

    subp_features.add_argument('-o', '--outpath', action='store',
                        help='Output file path.')

    subp_features.add_argument('file', type=str, nargs=1)
    subp_features.set_defaults(func=commands.apollon_features.main)

    return parser.parse_args(argv[1:])


def main(argv=None):
    if argv is None:
        argv = sys.argv

    args = _parse_cml(argv)
    args.func(args)


if __name__ == '__main__':
    sys.exit(main())
